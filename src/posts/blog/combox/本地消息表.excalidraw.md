---

excalidraw-plugin: parsed
tags: [excalidraw]

---
==⚠  Switch to EXCALIDRAW VIEW in the MORE OPTIONS menu of this document. ⚠== You can decompress Drawing data with the command palette: 'Decompress current Excalidraw file'. For more info check in plugin settings under 'Saving'


# Excalidraw Data

## Text Elements
可重试性事务，mq确保一定发送成功 ^zXJGIpe6

本质上和消息中心的消息发送思想一致 ^ififBgmN

1.业务操作
2.发送mq消息 ^qvPEjMjm

以订单为例 ^EPRVoTRp

1.用户下单
2.发送mq至库存中心 ^zPggUDjX

发送mq：

1. 进行消息记录，保证和业务操作在统一本地事务中
2. 异步发送，发送成功则更新消息记录状态，失败也记录
3. 定时任务做补偿器，间隔时间去扫描失败的进行重发


下游系统要保障消费幂等 ^ShPjAo8j

%%
## Drawing
```compressed-json
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
```
%%